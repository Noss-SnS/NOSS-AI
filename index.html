<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>NOSS AI - الذكاء الاصطناعي المتكامل</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- مكتبة جوجل لتسجيل الدخول -->
<script src="https://accounts.google.com/gsi/client" async defer></script>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;900&family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
  :root {
    --bg-color: #050505;
    --card-bg: rgba(20, 20, 20, 0.8);
    --primary: #00f2ff; /* سيان نيون */
    --secondary: #bd00ff; /* بنفسجي نيون */
    --text: #ffffff;
    --glass: rgba(255, 255, 255, 0.05);
  }

  * {margin:0;padding:0;box-sizing:border-box;}
  
  body {
    background-color: var(--bg-color);
    color: var(--text);
    font-family: 'Tajawal', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
    padding-bottom: 80px;
  }

  /* --- خلفية متحركة --- */
  .matrix-bg {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
    background: 
      radial-gradient(circle at 15% 50%, rgba(189, 0, 255, 0.05), transparent 25%),
      radial-gradient(circle at 85% 30%, rgba(0, 242, 255, 0.05), transparent 25%);
    overflow: hidden;
  }
  .grid-lines {
    position: absolute; width: 100%; height: 100%;
    background-image: 
      linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
    background-size: 50px 50px;
    transform: perspective(500px) rotateX(60deg);
    transform-origin: top center;
    animation: gridMove 20s linear infinite;
  }
  @keyframes gridMove { from {background-position: 0 0;} to {background-position: 0 500px;} }

  /* --- القائمة العلوية --- */
  nav {
    position: fixed; top: 0; width: 100%; z-index: 1000;
    background: rgba(5, 5, 5, 0.8); backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding: 15px 0;
  }
  .nav-content {
    max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 20px;
  }
  .logo {
    font-size: 28px; font-weight: 900; color: white; letter-spacing: 1px;
    text-shadow: 0 0 15px var(--primary);
  }
  .logo span { color: var(--primary); }
  
  .nav-center {
    display: flex; gap: 10px;
  }

  .nav-btns button {
    background: transparent; color: #aaa; border: none; padding: 10px 20px;
    font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s;
    border-radius: 20px; font-family: 'Cairo', sans-serif;
  }
  .nav-btns button:hover, .nav-btns button.active {
    color: white; background: var(--glass);
    box-shadow: 0 0 15px rgba(0, 242, 255, 0.2);
    text-shadow: 0 0 10px var(--primary);
  }

  /* --- قسم المستخدم (جديد) --- */
  .user-section {
    position: relative;
    display: flex; align-items: center;
  }
  .login-btn {
    background: linear-gradient(90deg, var(--secondary), var(--primary));
    border: none; padding: 8px 20px; color: white; border-radius: 30px;
    font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px;
    transition: 0.3s;
  }
  .login-btn:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(0, 242, 255, 0.4); }
  
  .user-profile {
    display: none; align-items: center; gap: 10px; 
    background: rgba(255,255,255,0.1); padding: 5px 15px 5px 5px; border-radius: 50px;
    border: 1px solid var(--primary);
  }
  .user-profile img {
    width: 35px; height: 35px; border-radius: 50%; border: 2px solid white;
  }
  .user-name { font-size: 14px; font-weight: bold; color: var(--primary); }
  .logout-icon { cursor: pointer; color: #ff4444; margin-right: 10px; font-size: 14px; }

  /* --- الصفحات --- */
  .page {
    display: none; padding-top: 100px; max-width: 1000px; margin: 0 auto; padding-left: 20px; padding-right: 20px;
    animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  }
  .page.active { display: block; }
  @keyframes slideUp { from {opacity:0; transform:translateY(50px);} to {opacity:1; transform:translateY(0);} }

  h1 { font-size: 40px; text-align: center; margin-bottom: 10px; text-shadow: 0 0 20px rgba(255,255,255,0.2); }
  p.desc { text-align: center; color: #888; margin-bottom: 40px; font-size: 18px; }

  /* --- المدخلات والأزرار --- */
  .input-wrapper {
    position: relative; margin-bottom: 30px;
  }
  input, textarea {
    width: 100%; padding: 20px; background: #111; border: 1px solid #333;
    border-radius: 15px; color: white; font-size: 18px; outline: none; transition: 0.3s;
    font-family: 'Tajawal', sans-serif;
  }
  input:focus, textarea:focus {
    border-color: var(--primary); box-shadow: 0 0 25px rgba(0, 242, 255, 0.15);
  }

  .action-btn {
    width: 100%; padding: 18px; border: none; border-radius: 15px;
    background: linear-gradient(135deg, var(--secondary), var(--primary));
    color: white; font-size: 20px; font-weight: 900; cursor: pointer;
    transition: 0.3s; position: relative; overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 242, 255, 0.2);
  }
  .action-btn:hover { transform: translateY(-3px); box-shadow: 0 20px 50px rgba(189, 0, 255, 0.4); }
  .action-btn:disabled { opacity: 0.6; cursor: wait; filter: grayscale(100%); }

  /* --- شاشة التحليل (Terminal) --- */
  .terminal {
    background: #000; border: 1px solid #333; border-radius: 10px; padding: 20px;
    font-family: 'Courier New', monospace; color: var(--primary); font-size: 14px;
    margin-top: 20px; height: 150px; overflow-y: auto; display: none; text-align: left; direction: ltr;
  }
  .log { margin: 5px 0; border-left: 2px solid var(--secondary); padding-left: 10px; animation: fadeIn 0.3s; }

  /* --- منطقة العرض --- */
  .preview-box {
    margin-top: 30px; background: var(--card-bg); padding: 20px; border-radius: 20px;
    border: 1px solid rgba(255,255,255,0.1); text-align: center; display: none;
  }
  video, img { width: 100%; border-radius: 10px; box-shadow: 0 5px 30px rgba(0,0,0,0.5); }
  
  .dl-btn {
    display: inline-block; margin-top: 20px; padding: 12px 40px;
    background: transparent; border: 2px solid white; color: white; text-decoration: none;
    border-radius: 50px; font-weight: bold; transition: 0.3s;
  }
  .dl-btn:hover { background: white; color: black; }

  /* --- الشات --- */
  .chat-container {
    height: 60vh; background: #0a0a0a; border-radius: 20px; border: 1px solid #333;
    display: flex; flex-direction: column; overflow: hidden;
  }
  .chat-messages {
    flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px;
  }
  .msg {
    max-width: 80%; padding: 15px 20px; border-radius: 20px; font-size: 16px; line-height: 1.5;
    animation: msgPop 0.3s ease; position: relative;
  }
  @keyframes msgPop { from {transform: scale(0.9); opacity: 0;} to {transform: scale(1); opacity: 1;} }
  
  .msg.user {
    align-self: flex-end; background: #222; color: white; border-bottom-right-radius: 5px;
    border: 1px solid #444;
  }
  .msg.ai {
    align-self: flex-start; background: linear-gradient(135deg, rgba(0, 242, 255, 0.1), rgba(189, 0, 255, 0.1));
    color: white; border-bottom-left-radius: 5px; border: 1px solid rgba(0, 242, 255, 0.3);
  }
  .msg.ai::before {
    content: 'NOSS'; position: absolute; top: -20px; right: 0; font-size: 10px; color: var(--primary);
  }

  .chat-input-area {
    padding: 15px; background: #111; border-top: 1px solid #333; display: flex; gap: 10px;
  }
  .chat-input-area input { margin: 0; border-radius: 50px; padding-right: 25px; }
  .send-btn {
    width: 60px; height: 60px; border-radius: 50%; border: none;
    background: var(--text); color: black; font-size: 20px; cursor: pointer; transition: 0.3s;
  }
  .send-btn:hover { transform: rotate(-45deg); background: var(--primary); }

  /* Canvas مخفي */
  canvas { display: none; }
  
  @media(max-width: 768px) {
    h1 {font-size: 28px;}
    .nav-content { flex-direction: column; gap: 15px; }
    .nav-btns button { padding: 8px 10px; font-size: 14px; }
    .logo {font-size: 22px;}
    .user-section { position: absolute; top: 15px; left: 20px; }
  }
</style>
</head>
<body>

<div class="matrix-bg"><div class="grid-lines"></div></div>

<nav>
  <div class="nav-content">
    <div class="logo">NOSS <span>AI</span></div>
    
    <div class="nav-center">
      <div class="nav-btns">
        <button class="active" onclick="setPage('chat')"><i class="fas fa-comment-alt"></i> محادثة</button>
        <button onclick="setPage('video')"><i class="fas fa-video"></i> فيديو</button>
        <button onclick="setPage('image')"><i class="fas fa-image"></i> صور</button>
      </div>
    </div>

    <!-- قسم المستخدم -->
    <div class="user-section">
      <!-- زر تسجيل الدخول (سيتم إخفاؤه عند الدخول) -->
      <button id="loginBtn" class="login-btn" onclick="triggerGoogleLogin()">
        <i class="fab fa-google"></i> تسجيل دخول
      </button>

      <!-- بروفايل المستخدم (يظهر بعد الدخول) -->
      <div id="userProfile" class="user-profile">
        <img id="userImg" src="" alt="User">
        <span id="userName" class="user-name"></span>
        <i class="fas fa-sign-out-alt logout-icon" onclick="signOut()" title="تسجيل خروج"></i>
      </div>
    </div>
  </div>
</nav>

<!-- صفحة الدردشة -->
<div id="chat" class="page active">
  <h1>المساعد الذكي المتطور</h1>
  <p class="desc">اسألني أي شيء، أنا متصل بالشبكة العصبية العالمية</p>
  
  <div class="chat-container">
    <div class="chat-messages" id="chatHistory">
      <div class="msg ai">مرحباً بك. أنا NOSS AI، عقلك الرقمي الجديد. كيف يمكنني مساعدتك اليوم؟</div>
    </div>
    <div class="chat-input-area">
      <input type="text" id="chatInput" placeholder="اكتب رسالتك هنا..." onkeypress="if(event.key==='Enter') sendMessage()">
      <button class="send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>
</div>

<!-- صفحة الفيديو -->
<div id="video" class="page">
  <h1>صانع الفيديو السينمائي</h1>
  <p class="desc">حول كلماتك إلى مشاهد متحركة واقعية</p>

  <div class="input-wrapper">
    <input type="text" id="vidPrompt" placeholder="صف المشهد (مثال: ناطحات سحاب في المستقبل وقت الغروب)">
  </div>
  <button class="action-btn" id="btnVid" onclick="makeVideo()">إنشاء الفيديو <i class="fas fa-magic"></i></button>
  
  <div class="terminal" id="vidTerm"></div>
  
  <div class="preview-box" id="vidPreview">
    <video id="finalVid" controls loop playsinline></video>
    <br>
    <a href="#" id="dlVid" class="dl-btn" download="NOSS_Scene.webm">تحميل الفيديو</a>
  </div>
</div>

<!-- صفحة الصور -->
<div id="image" class="page">
  <h1>مولد الصور 8K</h1>
  <p class="desc">دقة فائقة، تفاصيل مرعبة، خيال بلا حدود</p>

  <div class="input-wrapper">
    <input type="text" id="imgPrompt" placeholder="ماذا يدور في خيالك؟">
  </div>
  <button class="action-btn" id="btnImg" onclick="makeImage()">توليد الصورة <i class="fas fa-paint-brush"></i></button>
  
  <div class="terminal" id="imgTerm"></div>
  
  <div class="preview-box" id="imgPreview">
    <img id="finalImg" alt="Generated Image">
    <br>
    <a href="#" id="dlImg" class="dl-btn" download="NOSS_Image.jpg">تحميل الصورة</a>
  </div>
</div>

<!-- حاوية زر جوجل المخفي -->
<div id="g_id_onload" 
     data-client_id="YOUR_GOOGLE_CLIENT_ID" 
     data-callback="handleCredentialResponse"
     data-auto_prompt="false">
</div>

<canvas id="canvas"></canvas>

<script>
// --- إعدادات المستخدم ---
let currentUser = null;

// فحص وجود جلسة سابقة عند التحميل
window.onload = function() {
  const savedUser = localStorage.getItem('nossUser');
  if(savedUser) {
    currentUser = JSON.parse(savedUser);
    updateUI(true);
  }
};

// --- منطق تسجيل الدخول بجوجل ---
function triggerGoogleLogin() {
  // ملاحظة: ليعمل هذا الزر بشكل حقيقي، يجب عليك استبدال 'YOUR_GOOGLE_CLIENT_ID' في HTML أعلاه
  // بمعرف العميل الخاص بك من Google Cloud Console.
  // إذا لم يكن لديك واحد، سيعمل وضع المحاكاة هذا لترى النتيجة:
  
  const hasClientId = document.getElementById('g_id_onload').getAttribute('data-client_id') !== 'YOUR_GOOGLE_CLIENT_ID';
  
  if (hasClientId && window.google) {
    // تشغيل جوجل الحقيقي
    google.accounts.id.prompt(); 
  } else {
    // وضع المحاكاة (Demo) ليراه المستخدم فوراً بدون إعدادات
    simulateLogin();
  }
}

function simulateLogin() {
  const fakeUser = {
    name: "زائر مميز",
    picture: "https://cdn-icons-png.flaticon.com/512/3135/3135715.png"
  };
  handleLoginSuccess(fakeUser);
  alert("تنبيه: هذا وضع تجريبي. لتفعيل جوجل الحقيقي، ضع Client ID في الكود.");
}

// دالة استقبال البيانات من جوجل (الحقيقي)
function handleCredentialResponse(response) {
  // فك تشفير JWT (بشكل مبسط)
  const responsePayload = decodeJwt(response.credential);
  
  const user = {
    name: responsePayload.name,
    picture: responsePayload.picture
  };
  handleLoginSuccess(user);
}

function handleLoginSuccess(user) {
  currentUser = user;
  localStorage.setItem('nossUser', JSON.stringify(user));
  updateUI(true);
  
  // ترحيب في الشات
  const history = document.getElementById('chatHistory');
  history.innerHTML += `<div class="msg ai">أهلاً بعودتك يا ${user.name}! كل أدوات Noss AI جاهزة لأمرك.</div>`;
}

function signOut() {
  currentUser = null;
  localStorage.removeItem('nossUser');
  updateUI(false);
}

function updateUI(isLoggedIn) {
  const loginBtn = document.getElementById('loginBtn');
  const profile = document.getElementById('userProfile');
  
  if (isLoggedIn && currentUser) {
    loginBtn.style.display = 'none';
    profile.style.display = 'flex';
    document.getElementById('userName').textContent = currentUser.name;
    document.getElementById('userImg').src = currentUser.picture;
  } else {
    loginBtn.style.display = 'flex';
    profile.style.display = 'none';
  }
}

// دالة مساعدة لفك تشفير توكن جوجل
function decodeJwt(token) {
  var base64Url = token.split('.')[1];
  var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
  var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
  }).join(''));
  return JSON.parse(jsonPayload);
}

// --- التنقل ---
function setPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav-btns button').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
}

// --- نظام الدردشة الذكي ---
async function sendMessage() {
  const input = document.getElementById('chatInput');
  const history = document.getElementById('chatHistory');
  const text = input.value.trim();
  
  if(!text) return;
  
  history.innerHTML += `<div class="msg user">${text}</div>`;
  input.value = '';
  history.scrollTop = history.scrollHeight;

  const loadingId = 'loading-' + Date.now();
  history.innerHTML += `<div class="msg ai" id="${loadingId}">جاري التفكير... <i class="fas fa-circle-notch fa-spin"></i></div>`;
  history.scrollTop = history.scrollHeight;

  try {
    // تخصيص الرد بناءً على المستخدم
    let systemPrompt = "You are NOSS AI, a helpful, advanced, and cool AI assistant. Answer in Arabic mainly.";
    if(currentUser) {
      systemPrompt += ` The user's name is ${currentUser.name}. Be friendly to them.`;
    }

    const fullPrompt = `${systemPrompt}\nUser: ${text}\nAI:`;
    
    const response = await fetch(`https://text.pollinations.ai/${encodeURIComponent(fullPrompt)}`);
    if (!response.ok) throw new Error("Network error");
    const aiResponse = await response.text();
    
    document.getElementById(loadingId).remove();
    history.innerHTML += `<div class="msg ai">${formatText(aiResponse)}</div>`;
    
  } catch (err) {
    document.getElementById(loadingId).innerHTML = "عذراً، فقدت الاتصال بالخادم.";
  }
  history.scrollTop = history.scrollHeight;
}

function formatText(text) {
  return text.replace(/\n/g, '<br>');
}

// --- أدوات النظام (LOGS) ---
async function log(termId, txt) {
  const term = document.getElementById(termId);
  term.style.display = 'block';
  term.innerHTML += `<div class="log">> ${txt}</div>`;
  term.scrollTop = term.scrollHeight;
  await new Promise(r => setTimeout(r, 400));
}

// --- محرك الصور ---
async function makeImage() {
  const p = document.getElementById('imgPrompt').value;
  if(!p) return alert("اكتب وصفاً أولاً");
  
  const btn = document.getElementById('btnImg');
  const term = 'imgTerm';
  
  btn.disabled = true;
  document.getElementById(term).innerHTML = '';
  document.getElementById('imgPreview').style.display = 'none';
  
  await log(term, "Initializing Image Engine...");
  await log(term, `Analyzing prompt: "${p}"`);
  
  const enhanced = p + ", cinematic lighting, 8k, highly detailed, photorealistic, masterpiece, vivid colors";
  const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(enhanced)}?width=1024&height=1024&nologo=true&seed=${Math.floor(Math.random()*999)}`;
  
  const img = document.getElementById('finalImg');
  img.onload = () => {
    document.getElementById('imgPreview').style.display = 'block';
    document.getElementById('dlImg').href = url;
    btn.disabled = false;
    log(term, "Rendering Complete.");
  };
  img.src = url;
}

// --- محرك الفيديو ---
async function makeVideo() {
  const p = document.getElementById('vidPrompt').value;
  if(!p) return alert("صف المشهد أولاً");
  
  const btn = document.getElementById('btnVid');
  const term = 'vidTerm';
  
  btn.disabled = true;
  document.getElementById(term).innerHTML = '';
  document.getElementById('vidPreview').style.display = 'none';
  
  await log(term, "Constructing Scene Geometry...");
  
  const enhanced = p + ", wide angle shot, cinematic, 8k, motion blur style, dramatic atmosphere";
  const imgUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(enhanced)}?width=1280&height=720&nologo=true&seed=${Math.random()}`;
  
  await log(term, "Rendering Base Frames...");
  
  try {
    const imgObj = await new Promise((resolve, reject) => {
      const img = new Image();
      img.crossOrigin = "Anonymous";
      img.onload = () => resolve(img);
      img.onerror = () => reject("Image Load Failed");
      img.src = imgUrl;
    });

    await log(term, "Applying Camera Motion (Dolly Zoom)...");
    
    const blob = await recordAnimation(imgObj);
    const vidUrl = URL.createObjectURL(blob);
    
    const vid = document.getElementById('finalVid');
    vid.src = vidUrl;
    document.getElementById('dlVid').href = vidUrl;
    
    await log(term, "Video Encoding: VP9 WebM... OK.");
    document.getElementById('vidPreview').style.display = 'block';
    
  } catch (e) {
    await log(term, "Error: " + e);
  }
  btn.disabled = false;
}

function recordAnimation(img) {
  return new Promise(resolve => {
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 1280; canvas.height = 720;
    
    const stream = canvas.captureStream(30);
    const recorder = new MediaRecorder(stream, { mimeType: 'video/webm; codecs=vp9' });
    const chunks = [];
    
    recorder.ondataavailable = e => chunks.push(e.data);
    recorder.onstop = () => resolve(new Blob(chunks, {type: 'video/webm'}));
    
    recorder.start();
    
    let frame = 0;
    const maxFrames = 150; // 5 seconds
    
    function animate() {
      if(frame > maxFrames) {
        recorder.stop();
        return;
      }
      
      const scale = 1 + (frame * 0.002);
      const w = canvas.width * scale;
      const h = canvas.height * scale;
      const x = (canvas.width - w) / 2;
      const y = (canvas.height - h) / 2;
      
      ctx.clearRect(0,0, canvas.width, canvas.height);
      ctx.drawImage(img, x, y, w, h);
      
      ctx.fillStyle = `rgba(0,0,0,${0.1 - (frame/maxFrames)*0.1})`; 
      ctx.fillRect(0,0,canvas.width, canvas.height);
      
      frame++;
      requestAnimationFrame(animate);
    }
    animate();
  });
}
</script>
</body>
</html>