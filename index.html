<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<!-- إعدادات العرض للأجهزة المحمولة والآيفون -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>NOSS AI - The Core V2.3</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;900&family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
  :root {
    --bg-color: #000000;
    --primary: #00ff88;
    --secondary: #0099ff;
    --text: #ffffff;
    --glass: rgba(255, 255, 255, 0.05);
    --border: rgba(255, 255, 255, 0.1);
    /* Safe Area for iPhone Notch */
    --safe-bottom: env(safe-area-inset-bottom);
  }

  * {margin:0;padding:0;box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
  
  body {
    background-color: var(--bg-color);
    color: var(--text);
    font-family: 'Tajawal', sans-serif;
    min-height: 100vh;
    min-height: 100dvh; /* For mobile browsers */
    overflow-x: hidden;
    padding-bottom: calc(80px + var(--safe-bottom)); /* Dynamic padding */
  }

  /* === EFFECTS === */
  .scanlines {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 900;
    background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
    background-size: 100% 4px;
    animation: scanline 10s linear infinite;
    opacity: 0.6;
  }
  @keyframes scanline { from {background-position: 0 0;} to {background-position: 0 100%;} }
  
  /* الخلفية */
  .bg-animation {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
    background: radial-gradient(circle at 50% 50%, #111 0%, #000 100%);
  }
  .particles {
    position: absolute; width: 100%; height: 100%;
    background-image: radial-gradient(var(--primary) 1px, transparent 1px);
    background-size: 50px 50px;
    opacity: 0.1;
    animation: particleMove 30s linear infinite;
  }
  @keyframes particleMove { from {transform: translateY(0);} to {transform: translateY(-50px);} }

  /* القائمة العلوية - Desktop */
  nav {
    position: fixed; top: 0; width: 100%; z-index: 1000;
    background: rgba(0,0,0,0.85); backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border);
    height: 70px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px;
  }
  .logo { font-size: 24px; font-weight: 900; letter-spacing: 2px; }
  .logo span { color: var(--primary); text-shadow: 0 0 15px var(--primary); }

  .nav-tabs { display: flex; gap: 10px; }
  .nav-btn {
    background: transparent; border: none; color: #666; font-size: 14px; padding: 8px 15px;
    cursor: pointer; transition: 0.3s; border-radius: 20px; font-weight: bold;
    display: flex; align-items: center; gap: 8px;
  }
  .nav-btn.active { color: var(--bg-color); background: var(--primary); box-shadow: 0 0 15px var(--primary); }
  .nav-btn:hover:not(.active) { color: white; text-shadow: 0 0 5px white; }

  /* === Responsive Design (Mobile/iPhone) === */
  @media(max-width: 768px) {
    nav { 
      top: auto; bottom: 0; 
      border-top: 1px solid var(--border); border-bottom: none; 
      justify-content: center; height: auto;
      padding: 10px 10px calc(10px + var(--safe-bottom)); 
      background: rgba(0,0,0,0.95);
    }
    .logo, .user-info { display: none; }
    .nav-tabs { width: 100%; justify-content: space-between; gap: 5px; }
    .nav-btn { 
      flex-direction: column; font-size: 10px; gap: 5px; 
      padding: 10px 5px; flex: 1; border-radius: 12px;
    }
    .nav-btn i { font-size: 20px; margin-bottom: 2px; }
    
    /* Top Bar for Mobile */
    .mobile-top {
      position: fixed; top: 0; left: 0; width: 100%; padding: 15px 20px;
      padding-top: max(15px, env(safe-area-inset-top)); /* Safe area for Notch */
      display: flex; justify-content: space-between; align-items: center;
      background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); z-index: 999;
      border-bottom: 1px solid var(--border);
    }
  }
  @media(min-width: 769px) { .mobile-top { display: none; } }

  /* الصفحات */
  .page { 
    display: none; 
    padding: 100px 20px 40px; 
    max-width: 1200px; margin: 0 auto; 
    animation: fadeUp 0.4s ease;
    height: calc(100vh - 80px); /* Fill height minus nav */
  }
  .page.active { display: block; }
  
  @media(max-width: 768px) {
    .page { padding: 80px 15px 100px; height: auto; min-height: 80vh; }
  }

  @keyframes fadeUp { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }

  /* Chat Styles */
  .chat-container {
    background: #0a0a0a; border: 1px solid var(--border); border-radius: 20px;
    height: 100%; max-height: 75vh; display: flex; flex-direction: column; overflow: hidden; position: relative;
    box-shadow: 0 0 40px rgba(0,0,0,0.5);
  }
  .chat-header {
    padding: 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;
    background: rgba(255,255,255,0.02);
  }
  .messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
  .msg { max-width: 85%; padding: 12px 16px; border-radius: 15px; font-size: 15px; line-height: 1.6; word-wrap: break-word; }
  .msg.user { align-self: flex-end; background: #222; border-bottom-right-radius: 2px; border: 1px solid #333; }
  .msg.ai { align-self: flex-start; background: rgba(0, 255, 136, 0.05); color: var(--primary); border-bottom-left-radius: 2px; border: 1px solid rgba(0, 255, 136, 0.2); }
  
  .input-box {
    padding: 15px; background: #111; border-top: 1px solid var(--border); display: flex; gap: 10px;
  }
  .input-box input {
    flex: 1; background: #000; border: 1px solid #333; color: white; padding: 12px 20px; border-radius: 30px; outline: none; transition: 0.3s;
    font-size: 16px; /* Prevents zooming on iPhone input */
  }
  .input-box input:focus { border-color: var(--primary); box-shadow: 0 0 10px rgba(0,255,136,0.1); }
  .action-btn {
    width: 45px; height: 45px; border-radius: 50%; border: none; cursor: pointer;
    background: var(--primary); color: black; font-size: 18px; transition: 0.2s;
    display: flex; align-items: center; justify-content: center; flex-shrink: 0;
  }
  .action-btn:active { transform: scale(0.9); }

  /* Generator Box */
  .generator-box {
    text-align: center; background: rgba(255,255,255,0.02); padding: 30px; border-radius: 20px; border: 1px solid var(--border);
    position: relative; overflow: hidden;
  }
  .generator-box::before {
    content:''; position: absolute; top:0; left:0; width:100%; height:2px; background: linear-gradient(90deg, transparent, var(--primary), transparent);
    animation: scanlight 2s linear infinite;
  }
  @keyframes scanlight { 0% {left: -100%;} 100% {left: 100%;} }

  .gen-input {
    width: 100%; background: #000; border: 1px solid #333; color: white; padding: 15px;
    border-radius: 10px; margin: 20px 0; font-size: 16px; text-align: center;
  }
  .gen-btn-lg {
    background: linear-gradient(45deg, var(--secondary), var(--primary)); border: none;
    color: black; font-weight: 900; padding: 15px 40px; border-radius: 30px; cursor: pointer;
    font-size: 18px; box-shadow: 0 10px 30px rgba(0, 255, 136, 0.2); transition: 0.3s; width: 100%;
  }
  .media-result {
    margin-top: 30px; width: 100%; border-radius: 15px; border: 2px solid #333; display: none;
    box-shadow: 0 0 30px rgba(0,0,0,0.5);
  }

  /* === UPDATED CODER STYLES (Responsive) === */
  .coder-container { display: flex; flex-direction: column; gap: 20px; height: 100%; }
  .coder-split { display: flex; flex: 1; gap: 20px; height: 100%; min-height: 0; }
  
  .coder-editor, .coder-preview { 
    flex: 1; background: #0a0a0a; border: 1px solid var(--border); 
    border-radius: 15px; display: flex; flex-direction: column; overflow: hidden; 
  }
  
  .coder-header { 
    padding: 10px 15px; background: #151515; border-bottom: 1px solid var(--border); 
    font-size: 12px; color: #888; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 5px;
  }

  .coder-input-group {
    display: flex; gap: 10px; align-items: center; width: 100%;
  }
  
  #codeOutput {
    width:100%; height:100%; background:#080808; color:#0f0; 
    border:none; padding:15px; font-family:'Courier New', monospace; 
    resize:none; font-size: 14px; line-height: 1.5; outline: none;
  }
  #codeOutput:focus { background: #000; }

  .coder-preview iframe { width: 100%; height: 100%; border: none; background: white; }
  
  @media(max-width: 768px) {
    .coder-split { flex-direction: column; height: auto; }
    .coder-preview, .coder-editor { min-height: 400px; height: 400px; }
    .coder-container { height: auto; }
    .coder-input-group { flex-direction: column; }
    .coder-input-group button { width: 100% !important; }
  }

  /* Login & Loaders */
  .auth-modal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000;
    background: rgba(0,0,0,0.95); display: flex; flex-direction: column;
    align-items: center; justify-content: center; padding: 20px; text-align: center;
  }
  .auth-box {
    background: #111; padding: 30px; border-radius: 20px; border: 1px solid var(--border);
    width: 100%; max-width: 400px; box-shadow: 0 0 50px rgba(0, 255, 136, 0.1);
  }
  .auth-input {
    background: #000; border: 1px solid #333; color: white; padding: 15px; width: 100%;
    margin: 10px 0; text-align: center; border-radius: 10px; font-size: 16px;
  }
  .loader-overlay {
    position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8);
    display:none; align-items:center; justify-content:center; flex-direction:column; z-index: 10;
    backdrop-filter: blur(5px); border-radius: 20px;
  }
  .spinner {
    width: 50px; height: 50px; border: 5px solid #333; border-top-color: var(--primary);
    border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px;
  }
  @keyframes spin { 100% {transform: rotate(360deg);} }
</style>
</head>
<body>

<div class="bg-animation"><div class="particles"></div></div>
<div class="scanlines"></div>

<!-- Mobile Top Bar (Responsive) -->
<div class="mobile-top">
  <div class="logo">NOSS <span>AI</span></div>
  <div style="font-size:12px; color:#888; display:flex; gap:10px; align-items:center;">
    <span id="mobUser">Ghost</span>
    <i class="fas fa-sign-out-alt" onclick="logout()" style="color:#ff4444; cursor:pointer;"></i>
  </div>
</div>

<!-- Nav (Responsive Bottom on Mobile) -->
<nav>
  <div class="logo">NOSS <span>AI</span> <small style="font-size:10px;color:#666;font-weight:400;margin-right:5px;">CORE V2.3</small></div>
  <div class="nav-tabs">
    <button class="nav-btn active" onclick="setPage('chat')"><i class="fas fa-brain"></i> <span>القلب</span></button>
    <button class="nav-btn" onclick="setPage('coder')"><i class="fas fa-code"></i> <span>المطور (Web)</span></button>
    <button class="nav-btn" onclick="setPage('video')"><i class="fas fa-film"></i> <span>فيديو</span></button>
    <button class="nav-btn" onclick="setPage('image')"><i class="fas fa-image"></i> <span>مرسم</span></button>
  </div>
  <div class="user-info" style="display:flex;align-items:center;gap:15px;">
    <span id="deskUser" style="color:var(--primary); font-weight:bold; text-transform:uppercase;">Ghost</span>
    <button onclick="logout()" style="background:#222;color:#ff4444;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;"><i class="fas fa-power-off"></i></button>
  </div>
</nav>

<!-- === Auth Screen === -->
<div id="authScreen" class="auth-modal">
  <div class="auth-box">
    <h1 style="font-size: 30px; margin-bottom: 5px;">NOSS <span style="color:var(--primary)">ACCESS</span></h1>
    <p style="color:#666; margin-bottom: 25px; font-size:12px;">نظام التعريف الآمن</p>
    <div id="loginForm">
      <input type="text" id="loginUser" class="auth-input" placeholder="اسم المستخدم">
      <input type="password" id="loginPass" class="auth-input" placeholder="كلمة المرور">
      <button class="gen-btn-lg" style="margin-top:10px;" onclick="attemptLogin()">دخول للنظام</button>
      <div style="margin-top:15px;color:var(--secondary);cursor:pointer;font-size:12px;" onclick="toggleAuth('signup')">إنشاء هوية جديدة</div>
    </div>
    <div id="signupForm" style="display:none;">
      <input type="text" id="signUser" class="auth-input" placeholder="اسم مستخدم جديد">
      <input type="password" id="signPass" class="auth-input" placeholder="كلمة المرور">
      <button class="gen-btn-lg" style="margin-top:10px; background:#444;" onclick="attemptSignup()">إنشاء</button>
      <div style="margin-top:15px;color:var(--secondary);cursor:pointer;font-size:12px;" onclick="toggleAuth('login')">رجوع</div>
    </div>
    <p id="authMsg" style="color:#ff4444; margin-top:10px; font-size:12px; height:15px;"></p>
  </div>
</div>

<!-- === Chat Page === -->
<div id="chat" class="page active">
  <div class="chat-container">
    <div class="chat-header">
      <span><i class="fas fa-circle" style="color:var(--primary);font-size:10px;"></i> الشبكة العصبية</span>
      <span style="cursor:pointer; color:#ff4444; font-size:12px;" onclick="clearMemory()">مسح الذاكرة</span>
    </div>
    <div class="messages" id="msgContainer"></div>
    <div class="input-box">
      <input type="text" id="chatInput" placeholder="اكتب رسالتك..." onkeypress="if(event.key==='Enter') sendChat()">
      <button class="action-btn" onclick="sendChat()"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>
</div>

<!-- === WEB CODER (Deployed Feature) === -->
<div id="coder" class="page">
  <div class="coder-container">
    <div class="generator-box" style="padding:15px; flex:0; display:flex; flex-direction:column; gap:10px;">
      <h2 style="font-size:18px; color:white; text-align:right; margin-bottom:5px;">
        <i class="fas fa-terminal" style="color:var(--primary)"></i> أوامر بناء الموقع
      </h2>
      <div class="coder-input-group">
        <input type="text" id="codePrompt" class="gen-input" style="margin:0; text-align:right; flex:1;" placeholder="صف الموقع (مثال: متجر الكتروني بتصميم عصري)">
        <button class="action-btn" style="border-radius:10px; width:120px; font-size:14px; font-weight:bold;" onclick="generateWebsite()">
          تنفيذ <i class="fas fa-microchip"></i>
        </button>
      </div>
    </div>
    
    <div class="coder-split">
      <div class="coder-editor">
        <div class="coder-header">
          <span>Source Code</span>
          <button onclick="updatePreview()" style="background:var(--primary); color:black; border:none; padding:4px 12px; border-radius:4px; cursor:pointer; font-weight:bold; font-size:11px;">
            تحديث <i class="fas fa-sync"></i>
          </button>
        </div>
        <textarea id="codeOutput" spellcheck="false" placeholder="// الكود المولد سيظهر هنا..."></textarea>
      </div>
      
      <div class="coder-preview">
        <div class="coder-header">
          <span>المعاينة</span>
          <div style="display:flex; gap:5px;">
            <button onclick="deployWebsite()" style="background:#8a2be2; border:none; color:white; padding:4px 12px; border-radius:4px; cursor:pointer; font-size:11px;">
              نشر سحابي <i class="fas fa-globe"></i>
            </button>
            <button onclick="downloadWebsite()" style="background:var(--secondary); border:none; color:white; padding:4px 12px; border-radius:4px; cursor:pointer; font-size:11px;">
              تحميل <i class="fas fa-download"></i>
            </button>
          </div>
        </div>
        <div id="codeLoader" class="loader-overlay"><div class="spinner"></div><p>جاري البناء...</p></div>
        <iframe id="previewFrame"></iframe>
      </div>
    </div>
  </div>
</div>

<!-- === Video === -->
<div id="video" class="page">
  <div class="generator-box">
    <h1>محرك الفيديو</h1>
    <input type="text" id="vidPrompt" class="gen-input" placeholder="وصف المشهد السينمائي...">
    <div id="vidLoader" class="loader-overlay"><div class="spinner"></div><p>جاري المعالجة...</p></div>
    <video id="vidResult" class="media-result" controls loop playsinline></video>
    <button class="gen-btn-lg" onclick="createVideo()">إنشاء</button>
  </div>
</div>

<!-- === Image === -->
<div id="image" class="page">
  <div class="generator-box">
    <h1>مولد الصور 8K</h1>
    <input type="text" id="imgPrompt" class="gen-input" placeholder="وصف الصورة...">
    <div id="imgLoader" class="loader-overlay"><div class="spinner"></div><p>جاري الرسم...</p></div>
    <img id="imgResult" class="media-result">
    <button class="gen-btn-lg" onclick="createImage()">توليد</button>
  </div>
</div>

<canvas id="renderCanvas" style="display:none;"></canvas>

<script>
// === System Core ===
const DB_NAME = 'noss_users_v2';
let currentUser = null;
let chatMemory = [];

function init() {
  const session = localStorage.getItem('noss_session');
  if(session) {
    currentUser = session;
    loginSuccess();
  } else {
    document.getElementById('authScreen').style.display = 'flex';
  }
}

// Auth Logic
function getUsersDB() { return JSON.parse(localStorage.getItem(DB_NAME) || '{}'); }
function hash(s) { return btoa(s).split('').reverse().join(''); }

function attemptLogin() {
  const u = document.getElementById('loginUser').value.trim();
  const p = document.getElementById('loginPass').value.trim();
  const db = getUsersDB();
  const msg = document.getElementById('authMsg');
  if(db[u] && db[u] === hash(p)) {
    localStorage.setItem('noss_session', u);
    currentUser = u;
    loginSuccess();
  } else {
    msg.innerText = 'بيانات خاطئة';
  }
}

function attemptSignup() {
  const u = document.getElementById('signUser').value.trim();
  const p = document.getElementById('signPass').value.trim();
  const db = getUsersDB();
  if(u.length < 3) return alert('الاسم قصير جداً');
  if(db[u]) return alert('الاسم مستخدم مسبقاً');
  db[u] = hash(p);
  localStorage.setItem(DB_NAME, JSON.stringify(db));
  localStorage.setItem('noss_session', u);
  currentUser = u;
  loginSuccess();
}

function loginSuccess() {
  document.getElementById('authScreen').style.display = 'none';
  document.getElementById('deskUser').innerText = currentUser;
  document.getElementById('mobUser').innerText = currentUser;
  chatMemory = JSON.parse(localStorage.getItem(`mem_${currentUser}`) || '[]');
  loadChat();
}

function logout() { localStorage.removeItem('noss_session'); location.reload(); }
function toggleAuth(m) {
  document.getElementById('loginForm').style.display = m==='login'?'block':'none';
  document.getElementById('signupForm').style.display = m==='signup'?'block':'none';
}

function setPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  event.currentTarget.classList.add('active');
}

// === Chat Logic ===
function loadChat() {
  const c = document.getElementById('msgContainer'); c.innerHTML='';
  chatMemory.forEach(m => addMsgHTML(m.role, m.content));
}
function addMsgHTML(role, txt) {
  const d = document.createElement('div'); d.className = `msg ${role}`;
  d.innerHTML = txt.replace(/\n/g, '<br>');
  const c = document.getElementById('msgContainer'); c.appendChild(d); c.scrollTop=c.scrollHeight;
}
async function sendChat() {
  const inp = document.getElementById('chatInput'); const txt = inp.value.trim();
  if(!txt) return;
  addMsgHTML('user', txt); inp.value='';
  chatMemory.push({role:'user',content:txt});
  
  const loadDiv = document.createElement('div'); loadDiv.className='msg ai'; 
  loadDiv.innerHTML='...'; document.getElementById('msgContainer').appendChild(loadDiv);
  
  const sysPrompt = `Identity: NOSS AI, Advanced Assistant. Language: Arabic. User: ${currentUser}.`;
  const conversation = chatMemory.slice(-6).map(m=>`${m.role}:${m.content}`).join('\n');

  try {
    const res = await fetch(`https://text.pollinations.ai/${encodeURIComponent(sysPrompt + '\n' + conversation + '\nUser:' + txt + '\nAI:')}`);
    const r = await res.text();
    loadDiv.remove(); addMsgHTML('ai', r);
    chatMemory.push({role:'ai',content:r});
    localStorage.setItem(`mem_${currentUser}`, JSON.stringify(chatMemory));
  } catch(e) { loadDiv.innerText='Error'; }
}
function clearMemory() { chatMemory=[]; localStorage.removeItem(`mem_${currentUser}`); loadChat(); }

// === CODER ENGINE V2.3 (Publishing + Memory) ===
async function generateWebsite() {
  const prompt = document.getElementById('codePrompt').value;
  if(!prompt) return alert("الرجاء وصف الطلب أولاً");
  
  const loader = document.getElementById('codeLoader');
  const codeArea = document.getElementById('codeOutput');
  
  loader.style.display = 'flex';
  
  let currentCode = codeArea.value.trim();
  let aiPrompt = "";

  if (currentCode && !prompt.includes("جديد") && !prompt.includes("new")) {
    aiPrompt = `Task: Update this HTML code based on request. Code: ${currentCode.substring(0, 15000)}. Request: ${prompt}. Return FULL HTML code only.`;
  } else {
    aiPrompt = `Create a Responsive Single-File HTML Website (CSS/JS embedded) for: ${prompt}. Return ONLY valid HTML. Start with <!DOCTYPE html>.`;
  }

  try {
    const res = await fetch(`https://text.pollinations.ai/${encodeURIComponent(aiPrompt)}?model=openai`);
    let code = await res.text();
    code = code.replace(/```html/g, '').replace(/```/g, '');
    
    // Inject NOSS Watermark
    const watermarkHTML = `
    <a href="https://noss-sns.github.io/NOSS-AI/" target="_blank" 
       style="position:fixed; bottom:10px; right:10px; z-index:99999; 
              background:rgba(0,0,0,0.8); color:#00ff88; padding:5px 12px; 
              border-radius:20px; text-decoration:none; font-family:sans-serif; 
              font-size:12px; border:1px solid #00ff88; box-shadow:0 0 10px rgba(0,255,136,0.3);">
       NOSS
    </a>`;
    
    if(code.includes('</body>')) {
      code = code.replace('</body>', watermarkHTML + '</body>');
    } else {
      code += watermarkHTML;
    }

    codeArea.value = code;
    updatePreview();
    
  } catch(e) {
    alert("خطأ في الاتصال");
  } finally {
    loader.style.display = 'none';
  }
}

function updatePreview() {
  const code = document.getElementById('codeOutput').value;
  const preview = document.getElementById('previewFrame');
  const doc = preview.contentWindow.document;
  doc.open();
  doc.write(code);
  doc.close();
}

function downloadWebsite() {
  const code = document.getElementById('codeOutput').value;
  if(!code) return alert("لا يوجد كود!");
  const a = document.createElement("a");
  a.href = URL.createObjectURL(new Blob([code], {type: "text/html"}));
  a.download = "noss_site.html";
  a.click();
}

// New: Deploy Feature (Live URL Simulation)
function deployWebsite() {
  const code = document.getElementById('codeOutput').value;
  if(!code) return alert("أنشئ موقعاً أولاً!");
  
  // إنشاء رابط Blob يعمل كرابط ويب حقيقي للمستخدم الحالي
  const blob = new Blob([code], {type: "text/html"});
  const url = URL.createObjectURL(blob);
  
  // فتح في نافذة جديدة
  window.open(url, '_blank');
  
  // إشعار
  alert("تم نشر الموقع في بيئة مؤقتة (Live Preview). انسخ الرابط من التبويب الجديد لمشاركته (ملاحظة: هذا الرابط محلي).");
}

// === Media ===
async function createImage() {
  const p = document.getElementById('imgPrompt').value; if(!p) return;
  const l = document.getElementById('imgLoader'); const i = document.getElementById('imgResult');
  l.style.display='flex'; i.style.display='none';
  const enhancedP = `${p}, masterpiece, 8k, ultra-detailed`;
  i.onload=()=>{l.style.display='none';i.style.display='block';};
  i.src=`https://image.pollinations.ai/prompt/${encodeURIComponent(enhancedP)}?model=flux&width=1024&height=1024&nologo=true&seed=${Math.random()}`;
}

async function createVideo() {
  const p = document.getElementById('vidPrompt').value; if(!p) return;
  const l = document.getElementById('vidLoader'); const v = document.getElementById('vidResult');
  l.style.display='flex'; v.style.display='none';
  const enhancedP = `${p}, cinematic shot, 8k, motion blur`;
  
  const img = new Image(); img.crossOrigin="Anonymous";
  img.src = `https://image.pollinations.ai/prompt/${encodeURIComponent(enhancedP)}?width=1280&height=720&nologo=true&seed=${Math.random()}`;
  img.onload = async () => {
    const canvas = document.getElementById('renderCanvas');
    const ctx = canvas.getContext('2d'); canvas.width=1280; canvas.height=720;
    const stream = canvas.captureStream(30);
    const rec = new MediaRecorder(stream, {mimeType:'video/webm;codecs=vp9'});
    const chunks = []; rec.ondataavailable=e=>chunks.push(e.data);
    rec.onstop=()=>{
      v.src = URL.createObjectURL(new Blob(chunks,{type:'video/webm'}));
      l.style.display='none'; v.style.display='block'; v.play();
    };
    rec.start();
    let f=0; function anim(){
      if(f>90) {rec.stop();return;}
      ctx.drawImage(img, -f, -f, 1280+(f*2), 720+(f*2)); 
      f++; requestAnimationFrame(anim);
    }
    anim();
  };
}

init();
</script>
</body>
</html>