<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#000000">
<title>NOSS AI - V1.3 Root</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
  :root {
    --bg: #050505;
    --prim: #00ff88;
    --sec: #00ccff;
    --dev: #ff0055;
    --text: #e0e0e0;
    --glass: rgba(10, 10, 10, 0.9);
    --border: 1px solid rgba(255, 255, 255, 0.1);
    --safe: env(safe-area-inset-bottom);
  }

  * {margin:0;padding:0;box-sizing:border-box;outline:none;-webkit-tap-highlight-color:transparent;}
  body {background:var(--bg);color:var(--text);font-family:'Tajawal';height:100dvh;overflow:hidden;background-image:radial-gradient(circle at 50% 50%,#111 0%,#000 100%);transition:background 0.5s;}

  /* --- ANTI-DDOS SCREEN --- */
  #ddos {
    position:fixed;inset:0;background:#000;z-index:99999;display:flex;flex-direction:column;
    align-items:center;justify-content:center;transition:opacity 0.5s;
  }
  .shield {font-size:60px;color:var(--prim);animation:pulse 1s infinite;margin-bottom:20px;}
  .load-bar {width:200px;height:4px;background:#222;border-radius:2px;overflow:hidden;margin-top:20px;}
  .fill {width:0%;height:100%;background:var(--prim);animation:load 2.5s forwards;}
  @keyframes load{to{width:100%;}}
  @keyframes pulse{50%{transform:scale(1.1);opacity:0.8;}}

  /* HEADER & NAV */
  nav {
    position:fixed;top:0;width:100%;height:65px;z-index:1000;background:rgba(0,0,0,0.95);
    border-bottom:var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 20px;
  }
  .logo {font-size:22px;font-weight:900;}
  .logo span {color:var(--prim);text-shadow:0 0 10px var(--prim);}
  
  .nav-btns {display:flex;gap:5px;}
  .nb {
    background:transparent;color:#888;border:1px solid transparent;padding:6px 15px;
    border-radius:20px;cursor:pointer;font-size:12px;font-weight:bold;transition:0.3s;
    display:flex;gap:6px;align-items:center;
  }
  .nb.active {background:var(--prim);color:#000;box-shadow:0 0 10px var(--prim);}
  #btnAdmin, #btnDev {display:none;} /* Hidden by default */

  /* MOBILE */
  @media(max-width:768px){
    nav {top:auto;bottom:0;justify-content:center;height:70px;border-top:var(--border);border-bottom:none;padding-bottom:var(--safe);}
    .logo,.u-info {display:none;}
    .nav-btns {width:100%;justify-content:space-evenly;}
    .nb {flex-direction:column;font-size:10px;padding:5px;gap:2px;} .nb i{font-size:18px;}
    .m-top {position:fixed;top:0;width:100%;padding:10px 15px;background:#000;border-bottom:var(--border);display:flex;justify-content:space-between;align-items:center;z-index:999;padding-top:env(safe-area-inset-top);}
  } @media(min-width:769px){.m-top{display:none;}}

  /* PAGES */
  .page {
    position:absolute;top:65px;left:0;width:100%;height:calc(100dvh - 65px - 30px);
    padding:15px;display:none;overflow-y:auto;overflow-x:hidden;
  }
  .page.active {display:block;animation:in 0.3s ease;}
  @media(max-width:768px){.page{top:50px;height:calc(100dvh - 50px - 70px - 30px);}}
  @keyframes in{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}

  /* COMPONENTS */
  .card {background:rgba(255,255,255,0.03);border:var(--border);border-radius:15px;padding:15px;margin-bottom:15px;}
  .card h3 {
    color:var(--prim);border-bottom:1px solid #333;padding-bottom:10px;margin-bottom:15px;
    font-size:14px;display:flex;align-items:center;gap:10px;
  }
  .btn {width:100%;padding:10px;background:#222;color:#fff;border:1px solid #333;border-radius:8px;cursor:pointer;font-weight:bold;margin-top:5px;}
  .btn-p {background:var(--prim);color:#000;border:none;}
  .inp {width:100%;background:#000;color:#fff;padding:10px;border:1px solid #333;border-radius:8px;margin-bottom:10px;}

  /* ADMIN SPECIFIC */
  .stats-grid {display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:15px;text-align:center;}
  .stat {background:#111;padding:10px;border-radius:10px;border:1px solid #222;}
  .stat h2 {margin:0;font-size:24px;color:#fff;}
  .stat span {font-size:10px;color:#888;}
  .tbl {width:100%;font-size:12px;border-collapse:collapse;color:#ccc;}
  .tbl th, .tbl td {text-align:right;padding:8px;border-bottom:1px solid #222;}
  .tbl th {color:var(--prim);}

  /* CHAT */
  .chat-box {height:100%;background:rgba(20,20,20,0.6);border:var(--border);border-radius:15px;display:flex;flex-direction:column;overflow:hidden;}
  .msgs {flex:1;padding:15px;overflow-y:auto;display:flex;flex-direction:column;gap:15px;}
  .msg {padding:10px 15px;border-radius:15px;font-size:14px;max-width:80%;word-wrap:break-word;}
  .my-msg {align-self:flex-end;background:#222;border-bottom-left-radius:2px;}
  .ai-msg {align-self:flex-start;background:rgba(0,255,136,0.1);color:#cfc;border-bottom-right-radius:2px;}
  
  .c-foot {padding:10px;background:#000;display:flex;gap:10px;align-items:center;border-top:var(--border);}
  .ic-btn {width:40px;height:40px;border-radius:50%;background:#151515;color:#888;border:1px solid #333;display:flex;justify-content:center;align-items:center;cursor:pointer;}
  .ic-btn.mic.on {color:#f00;border-color:#f00;animation:pulse 1s infinite;}

  /* DEV */
  .code-editor {width:100%;height:300px;background:#0a0a0a;color:#0f0;font-family:monospace;padding:15px;border:1px solid #333;border-radius:10px;resize:vertical;}

  /* FOOTER */
  .footer {position:fixed;bottom:0;width:100%;height:30px;background:#000;border-top:var(--border);display:flex;align-items:center;padding-bottom:var(--safe);z-index:900;}
  @media(max-width:768px){.footer{bottom:70px;}}
  .tick-txt {animation:tk 20s linear infinite;white-space:nowrap;padding-left:100%;color:var(--prim);font-size:11px;font-weight:700;}
  @keyframes tk{100%{transform:translateX(-100%);}}

  /* AUTH */
  .auth-scr {position:fixed;inset:0;background:rgba(0,0,0,0.96);z-index:5000;display:flex;justify-content:center;align-items:center;}
  .auth-card {width:300px;background:#080808;padding:30px;border-radius:20px;border:1px solid var(--prim);text-align:center;}
</style>
</head>
<body>

<!-- ANTI-DDOS FAKE LAYER -->
<div id="ddos">
  <div class="shield"><i class="fas fa-shield-alt"></i></div>
  <h2 style="color:#fff;font-family:Arial;">NOSS PROTECTION</h2>
  <div style="color:#666;font-size:12px;margin-top:5px;">Verifying connection security...</div>
  <div class="load-bar"><div class="fill"></div></div>
</div>

<!-- TOP (Mobile) -->
<div class="m-top">
  <div class="logo">NOSS <span style="font-size:10px;">V1.3</span></div>
  <i class="fas fa-sign-out-alt" onclick="out()" style="color:#f44;cursor:pointer;"></i>
</div>

<nav>
  <div class="logo">NOSS <span>AI</span></div>
  <div class="nav-btns">
    <button class="nb active" onclick="go('chat')"><i class="fas fa-comment"></i> الشات</button>
    <button class="nb" onclick="go('coder')"><i class="fas fa-laptop-code"></i> المطور</button>
    <button class="nb" id="btnAdmin" onclick="go('admin')"><i class="fas fa-cogs"></i> الإدارة</button>
    <button class="nb" id="btnDev" onclick="go('dev')"><i class="fas fa-terminal"></i> النواة</button>
  </div>
  <div class="u-info" style="display:flex;align-items:center;gap:10px;">
    <span id="usrNm" style="color:#fff;font-size:12px;font-weight:bold;">User</span>
    <button onclick="out()" style="background:#222;border:none;color:#f44;padding:5px;border-radius:5px;cursor:pointer;"><i class="fas fa-power-off"></i></button>
  </div>
</nav>

<!-- AUTH -->
<div id="auth" class="auth-scr">
  <div class="auth-card">
    <i class="fas fa-fingerprint" style="font-size:40px;color:var(--prim);margin-bottom:20px;"></i>
    
    <div id="logF">
      <input type="email" id="le" class="inp" placeholder="Gmail Address">
      <input type="password" id="lp" class="inp" placeholder="Password">
      <button onclick="login()" class="btn btn-p">دخول</button>
      <div style="color:#666;font-size:11px;margin-top:10px;cursor:pointer;" onclick="tAuth()">حساب جديد؟</div>
    </div>

    <div id="sigF" style="display:none;">
      <input type="email" id="se" class="inp" placeholder="Your Gmail">
      <input type="password" id="sp" class="inp" placeholder="New Password">
      <button onclick="signup()" class="btn" style="background:#fff;color:#000;">إنشاء</button>
      <div style="color:#666;font-size:11px;margin-top:10px;cursor:pointer;" onclick="tAuth()">رجوع</div>
    </div>
  </div>
</div>

<!-- PAGE 1: CHAT -->
<div id="chat" class="page active">
  <div class="chat-box">
    <div class="msgs" id="cBox"><div class="msg ai-msg">مرحباً بك في النظام الآمن V1.3.</div></div>
    <div class="c-foot">
      <input type="file" id="fUl" hidden onchange="uF(this)">
      <button class="ic-btn" onclick="document.getElementById('fUl').click()"><i class="fas fa-paperclip"></i></button>
      <button class="ic-btn mic" id="mBtn" onclick="tMic()"><i class="fas fa-microphone"></i></button>
      <input type="text" id="tx" class="inp" style="margin:0;border-radius:30px;" placeholder="اكتب..." onkeypress="if(event.key==='Enter')snd()">
      <button class="ic-btn" style="background:var(--prim);color:#000;" onclick="snd()"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>
</div>

<!-- PAGE 2: CODER -->
<div id="coder" class="page">
  <div class="card">
    <input type="text" id="cp" class="inp" placeholder="صف الموقع المطلوب...">
    <button onclick="bld()" class="btn btn-p">إنشاء الكود</button>
  </div>
  <div style="display:flex;height:400px;gap:10px;">
    <textarea id="co" style="flex:1;background:#111;color:#0f0;padding:10px;border:1px solid #333;"></textarea>
    <iframe id="cv" style="flex:1;background:#fff;border:none;"></iframe>
  </div>
</div>

<!-- PAGE 3: ADMIN (REBUILT AS REQUESTED) -->
<div id="admin" class="page">
  
  <!-- 1. Stats -->
  <div class="stats-grid">
    <div class="stat">
      <h2 id="cntU">0</h2>
      <span>المستخدمين</span>
    </div>
    <div class="stat">
      <h2 style="color:var(--prim);">99%</h2>
      <span>الصحة</span>
    </div>
    <div class="stat">
      <h2 id="cntM">0</h2>
      <span>الرسائل</span>
    </div>
  </div>

  <!-- 2. Maintenance -->
  <div class="card">
    <h3><i class="fas fa-tools"></i> التحكم</h3>
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <span>وضع الصيانة (Maintenance)</span>
      <input type="checkbox" id="mChk" onchange="sM(this)">
    </div>
  </div>

  <!-- 3. Users Table -->
  <div class="card">
    <h3><i class="fas fa-users"></i> المستخدمين</h3>
    <div style="overflow-x:auto;">
      <table class="tbl">
        <thead><tr><th>المستخدم</th><th>الحالة</th><th>إجراء</th></tr></thead>
        <tbody id="tBody"></tbody>
      </table>
    </div>
  </div>

  <!-- 4. Appearance -->
  <div class="card">
    <h3><i class="fas fa-paint-brush"></i> المظهر</h3>
    <label>لون النظام:</label> <input type="color" id="cl1" class="inp" style="padding:2px;">
    <label>الخلفية:</label> <input type="color" id="cl2" class="inp" style="padding:2px;">
    <div style="display:flex;gap:10px;">
      <button onclick="svCol()" class="btn btn-p">حفظ</button>
      <button onclick="rsCol()" class="btn">استعادة</button>
    </div>
  </div>

  <!-- 5. Ticker -->
  <div class="card">
    <h3><i class="fas fa-bullhorn"></i> الشريط الإخباري</h3>
    <input type="text" id="tk" class="inp" placeholder="اكتب النص هنا...">
    <button onclick="svTk()" class="btn btn-p">تحديث</button>
  </div>
</div>

<!-- PAGE 4: DEV (SYSTEM EDITOR) -->
<div id="dev" class="page">
  <div class="card" style="border-color:#f05;">
    <h3 style="color:#f05;"><i class="fas fa-code"></i> System Kernel (Root Access)</h3>
    <p style="font-size:12px;color:#888;">هذا هو كود الموقع بالكامل. التعديل هنا سيغير النظام فوراً.</p>
    
    <div style="display:flex;gap:5px;margin:10px 0;">
      <button onclick="ldSys()" class="btn" style="width:auto;">سحب الكود</button>
      <button onclick="svSys()" class="btn" style="width:auto;background:#f05;">حفظ وتطبيق</button>
    </div>
    
    <textarea id="sysEd" class="code-editor" spellcheck="false"></textarea>
  </div>
</div>

<!-- FOOTER -->
<div class="footer"><div class="tick-txt" id="footT">SYSTEM V1.3 ROOT ACCESS ONLINE...</div></div>

<script>
/* CORE DATA */
const D='n13_d', S='n13_s', K='n_sess';
const A={'NOSS':'CVkaka@7','L7AJ':'l7ajtop1','DEV':'admindev'};
let U=null, R='';

/* STARTUP */
window.onload=()=>{
  setTimeout(()=>{document.getElementById('ddos').style.opacity='0';setTimeout(()=>document.getElementById('ddos').style.display='none',500);run();},2200);
};

function run(){
  loadTh();
  if(localStorage.getItem(K)) {
    U=localStorage.getItem(K);
    R=A[U]?'A':(getD()[U]?.r||'U');
    if(U==='DEV') R='D';
    
    if(R==='U' && getS().mnt) return (localStorage.removeItem(K),location.reload());
    
    document.getElementById('auth').style.display='none';
    document.getElementById('usrNm').innerText=U.split('@')[0];
    
    if(R==='A'||R==='D') { 
      document.getElementById('btnAdmin').style.display='flex';
      uAdm();
    }
    if(R==='D') { 
      document.getElementById('btnDev').style.display='flex';
      ldSys(); 
    }
    
    loadC();
  }
}

/* DATA HELPERS */
function getD(){return JSON.parse(localStorage.getItem(D)||'{}')}
function getS(){return JSON.parse(localStorage.getItem(S)||'{}')}
function svS(s){localStorage.setItem(S,JSON.stringify(s)); loadTh();}

/* AUTH */
function login(){
  let e=v('le'),p=v('lp');
  if(A[e] && A[e]===p) return ok(e);
  let d=getD();
  if(d[e] && d[e].p===p) return ok(e);
  alert('خطأ');
}
function signup(){
  let e=v('se'),p=v('sp');
  if(!e.includes('@gmail')) return alert('Gmail only');
  if(A[e]||getD()[e]) return alert('موجود');
  let d=getD(); d[e]={p:p,r:'U',j:Date.now()}; localStorage.setItem(D,JSON.stringify(d));
  ok(e);
}
function ok(u){ localStorage.setItem(K,u); location.reload(); }
function out(){ localStorage.removeItem(K); location.reload(); }
function tAuth(){ let l=document.getElementById('logF'),s=document.getElementById('sigF'); if(l.style.display==='none'){l.style.display='block';s.style.display='none'}else{l.style.display='none';s.style.display='block'} }

/* CHAT + MIC */
async function snd(){
  let t=v('tx'); if(!t)return;
  addM('u',t); document.getElementById('tx').value=''; saveC('u',t);
  
  if(t.match(/صورة|image/)){
    let u=`https://image.pollinations.ai/prompt/${encodeURIComponent(t)}`;
    addM('ai',`<img src="${u}" style="width:100%;border-radius:10px;">`);
    saveC('ai',`<img src="${u}">`);
  } else {
    let r=await fetch(`https://text.pollinations.ai/${encodeURIComponent(t)}`).then(x=>x.text());
    addM('ai',r); saveC('ai',r);
  }
}
function addM(w,t){ document.getElementById('cBox').innerHTML+=`<div class="msg ${w==='u'?'my-msg':'ai-msg'}">${t}</div>`; }
function saveC(w,t){ let k='ch_'+U,h=JSON.parse(localStorage.getItem(k)||'[]');h.push({w,t});localStorage.setItem(k,JSON.stringify(h)); if(R!=='U')uAdm(); }
function loadC(){ let h=JSON.parse(localStorage.getItem('ch_'+U)||'[]');h.forEach(m=>addM(m.w,m.t)); }
function uF(i){ let r=new FileReader();r.onload=e=>{addM('u',`<img src="${e.target.result}" width="100%">`);};r.readAsDataURL(i.files[0]); }

// Mic Logic
let rc; try{let W=window.webkitSpeechRecognition;if(W){rc=new W();rc.lang='ar-SA';rc.onresult=e=>{document.getElementById('tx').value=e.results[0][0].transcript;};rc.onend=()=>document.getElementById('mBtn').classList.remove('on');}}catch(e){}
function tMic(){ if(rc){let b=document.getElementById('mBtn'); if(b.classList.contains('on')){rc.stop()}else{rc.start();b.classList.add('on')}} else alert('غير مدعوم'); }

/* ADMIN */
function uAdm(){
  let d=getD(), s=getS();
  let msgs=0; Object.keys(localStorage).forEach(k=>{if(k.startsWith('ch_'))msgs+=JSON.parse(localStorage.getItem(k)).length});
  
  document.getElementById('cntU').innerText=Object.keys(d).length;
  document.getElementById('cntM').innerText=msgs;
  document.getElementById('mChk').checked=!!s.mnt;
  if(s.tk) document.getElementById('tk').value=s.tk;
  
  let h='';
  for(let u in d) h+=`<tr><td>${u}</td><td>User</td><td><button onclick="kick('${u}')" style="color:red;border:none;background:none;">حذف</button></td></tr>`;
  document.getElementById('tBody').innerHTML=h;
}
function kick(u){ if(confirm('حذف؟')){let d=getD();delete d[u];localStorage.setItem(D,JSON.stringify(d));uAdm();} }
function sM(e){ let s=getS(); s.mnt=e.checked; svS(s); }
function svTk(){ let s=getS(); s.tk=v('tk'); svS(s); }
function svCol(){ let s=getS(); s.cp=v('cl1'); s.bg=v('cl2'); svS(s); }
function rsCol(){ let s=getS(); delete s.cp; delete s.bg; svS(s); location.reload(); }
function loadTh(){ 
  let s=getS(),r=document.documentElement.style;
  if(s.cp)r.setProperty('--prim',s.cp);
  if(s.bg)r.setProperty('--bg',s.bg);
  if(s.tk)document.getElementById('footT').innerText=s.tk;
}

/* DEV (SYSTEM EDITOR) */
function ldSys(){
  // Gets the current live HTML of the page
  document.getElementById('sysEd').value = "<!DOCTYPE html>\n" + document.documentElement.outerHTML;
}
function svSys(){
  if(!confirm('تطبيق التغييرات؟ قد يتوقف الموقع عن العمل إذا أخطأت.'))return;
  document.open();
  document.write(document.getElementById('sysEd').value);
  document.close();
}

/* CODER */
async function bld(){
  let p=v('cp');if(!p)return;
  let c=await fetch(`https://text.pollinations.ai/html code for ${p}`).then(r=>r.text());
  c=c.replace(/```html|```/g,'');
  document.getElementById('co').value=c;
  let d=document.getElementById('cv').contentWindow.document;d.open();d.write(c);d.close();
}

/* UI */
function v(id){return document.getElementById(id).value;}
function go(p){
  document.querySelectorAll('.page').forEach(e=>e.classList.remove('active'));
  document.getElementById(p).classList.add('active');
  document.querySelectorAll('.nb').forEach(e=>e.classList.remove('active'));
  event.currentTarget.classList.add('active');
}
</script>
</body>
</html>
